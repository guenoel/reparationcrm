import{k as f,C as T,Q as j,m as A,D as _,f as n,a as y,u as o,w as h,F as b,o as l,Z as M,b as t,i as p,E as N,G as B,t as d,g as u,A as k,S as x}from"./app-W_FqAoan.js";import{_ as L}from"./AuthenticatedLayout-CHPYlGl3.js";import{d as w}from"./index-YllimRi1.js";import"./ApplicationLogo-WdHHSFEO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},$={key:0},O={key:1},W={class:"tasks__create"},G={class:"tasks__create__cardWrapper mt-2"},P={class:"tasks__create__main"},Q={class:"tasks__create__main--addInfo card py-2 px-2 bg-white"},Z=["value"],q={key:0,style:{color:"red"}},z={key:1,style:{color:"red"}},H={key:2,style:{color:"red"}},J={key:3,style:{color:"red"}},K={class:"devices__create__main--media--images mt-2"},X={class:"devices__create__main--media--images--list list-unstyled"},Y={class:"devices__create__main--media--images--item"},ee={class:"devices__create__main--media--images--item--imgWrapper"},se=["src"],te={class:"devices__create__main--media--images--item"},ae={class:"devices__create__main--media--images--item--form"},me={__name:"Form",setup(ie){const v=f(),i=T({service_id:"",start:"",end:"",description:""}),c=j(),g=f(!1);let r=f([]);A(()=>{c.props.route&&c.props.route.name==="tasks.edit"?(g.value=!0,v.value=c.props.route.params.id,D()):(S(),E())});const S=async()=>{try{let a=await _.get("/api/services?all=true");c.props.services=a.data.services;const e=new URLSearchParams(window.location.search);i.service_id=e.get("service_id")}catch(a){console.error("Error fetching services:",a)}},E=async()=>{try{i.user_id=c.props.auth.user.id}catch(a){console.error("Error fetching user:",a)}},D=async()=>{try{let a=await _.get(`/api/tasks/${v.value}/edit`);a.data.services&&(c.props.services=Object.entries(a.data.services).map(([e,s])=>({id:Number(e),description:s}))),a.data.task&&(i.service_id=a.data.task.service_id,i.start=a.data.task.start,i.end=a.data.task.end,i.description=a.data.task.description)}catch(a){console.error("Error fetching task data:",a)}},I=()=>{let a="/upload/no-image.jpg";return i.image&&(i.image.indexOf("base64")!=-1?a=i.image:a="/upload/"+i.image),a},U=a=>{const e=a.target;let s=e.files?e.files[0]:null;if(s){const m=new FileReader;m.onloadend=re=>{m.result&&(i.image=m.result)},m.readAsDataURL(s)}},V=(a,e)=>{g.value?F():C()},C=(a,e)=>{_.post("/api/tasks",i).then(s=>{x.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{w.Inertia.visit("/tasks/index/")},2e3)}).catch(s=>{s.response&&s.response.status===422?r.value=s.response.data.errors:console.error("Error creating task:",s)})},F=(a,e)=>{_.put(`/api/tasks/${v.value}`,i).then(s=>{x.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{w.Inertia.visit("/tasks/index/")},2e3)}).catch(s=>{s.response.status===422?r.value=s.response.data.errors:console.error("Error creating task:",s)})};return(a,e)=>(l(),n(b,null,[y(o(M),{title:"Enregistrement d'une tâche"}),y(L,null,{header:h(()=>[t("h2",R,[g.value?(l(),n("span",$,"Modification d'une tâche")):(l(),n("span",O,"Nouvelle tâche"))])]),default:h(()=>[t("div",W,[e[10]||(e[10]=t("div",{class:"tasks__create__titlebar dflex justify-content-between align-items-center"},[t("div",{class:"tasks__create__titlebar--item"},[t("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),t("div",G,[t("div",P,[t("div",Q,[e[5]||(e[5]=t("p",{class:"mb-1"},"Service ID",-1)),p(t("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.service_id=s),class:"input",id:"service_id",name:"service_id"},[(l(!0),n(b,null,B(o(c).props.services,s=>(l(),n("option",{key:s.id,value:s.id},d(s.device.user.name)+" -> "+d(s.device.brand)+" "+d(s.device.model_name)+" -> "+d(s.description),9,Z))),128))],512),[[N,i.service_id]]),o(r).service_id?(l(),n("small",q,d(o(r).service_id),1)):u("",!0),e[6]||(e[6]=t("p",{class:"mb-1"},"Début de la tâche",-1)),p(t("input",{type:"datetime-local",class:"input",id:"start",name:"start","onUpdate:modelValue":e[1]||(e[1]=s=>i.start=s)},null,512),[[k,i.start]]),o(r).start?(l(),n("small",z,d(o(r).start),1)):u("",!0),e[7]||(e[7]=t("p",{class:"mb-1"},"Fin de la tâche",-1)),p(t("input",{type:"datetime-local",class:"input",id:"end",name:"end","onUpdate:modelValue":e[2]||(e[2]=s=>i.end=s)},null,512),[[k,i.end]]),o(r).end?(l(),n("small",H,d(o(r).end),1)):u("",!0),e[8]||(e[8]=t("p",{class:"my-1"},"Description",-1)),p(t("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[3]||(e[3]=s=>i.description=s)},null,512),[[k,i.description]]),o(r).description?(l(),n("small",J,d(o(r).description),1)):u("",!0),t("div",K,[t("ul",X,[t("li",Y,[t("div",ee,[t("img",{src:I(),class:"devices__create__main--media--images--item--img",alt:""},null,8,se)])]),t("li",te,[t("form",ae,[e[4]||(e[4]=t("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),t("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:U},null,32)])])])])])])]),t("div",{class:"dflex justify-content-between align-items-center my-3"},[e[9]||(e[9]=t("p",null,null,-1)),t("button",{class:"btn btn-secondary",onClick:V},"Save")])])]),_:1})],64))}};export{me as default};
