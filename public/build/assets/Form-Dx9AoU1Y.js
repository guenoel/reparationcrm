import{k as v,C as q,Q as T,m as J,h as Q,l as V,D as b,f as r,a as C,u as m,w as D,F as f,o,Z as W,b as i,i as d,A as g,E as y,G as h,t as l,g as u,S as E}from"./app-Dkm1rt9V.js";import{_ as G}from"./AuthenticatedLayout-CixOTf3m.js";import{d as F}from"./index-CLCCGICM.js";import"./ApplicationLogo-mZEy1bWB.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const P={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},Z={key:0},z={key:1},H={class:"devices__create"},K={class:"devices__create__cardWrapper mt-2"},X={class:"devices__create__main"},Y={class:"devices__create__main--addInfo card py-2 px-2 bg-white"},ee={key:0},se=["value"],te={key:0,style:{color:"red"}},ie={key:1},ae=["value"],re={key:0,style:{color:"red"}},oe=["disabled"],le=["value"],ne={key:1,style:{color:"red"}},de=["disabled"],ue=["value"],me={key:2,style:{color:"red"}},ce={key:2},pe={class:"mb-1"},_e={class:"mb-1"},ve={class:"mb-1"},be={class:"mb-1"},fe={class:"mb-1"},ge={class:"mb-1"},ye={class:"mb-1"},ke={key:3},xe={key:4},he={key:5},we={class:"devices__create__main--media--images mt-2"},Ue={class:"devices__create__main--media--images--list list-unstyled"},Ve={class:"devices__create__main--media--images--item"},Ne={class:"devices__create__main--media--images--item--imgWrapper"},Se=["src"],Ae={class:"devices__create__main--media--images--item"},Ce={class:"devices__create__main--media--images--item--form"},Be={__name:"Form",setup(De){const w=v(),s=q({image:"",user_id:"",brand:"",model_name:"",model_number:"",color:"",serial_number:"",imei:"",description:"",returned:""}),c=T(),p=v(!1);let n=v([]);const _=v(!1),k=v(""),N=v([]),S=v([]),U=v([]);J(()=>{const a=c.props.auth.user;a&&a.role===0&&(_.value=!0,s.user_id=a.id),c.props.route&&c.props.route.name==="devices.edit"?(p.value=!0,w.value=c.props.route.params.id,$()):(I(),M())});const A=Q(()=>k.value.trim()?c.props.users.filter(a=>a.name.toLowerCase().includes(k.value.toLowerCase())):c.props.users);V(A,a=>{a.length>0&&(s.user_id=a[0].id)}),V(()=>s.brand,async a=>{if(a)try{const e=await b.get(`/api/models/${a}`);S.value=e.data.map(t=>t.modelValue),s.model_name="",U.value=[]}catch(e){console.error("Erreur lors de la récupération des noms de modèle :",e)}}),V(()=>s.model_name,async a=>{if(a)try{const e=await b.get(`/api/model-numbers/${s.brand}/${a}`);U.value=Array.isArray(e.data)?e.data:[],s.model_number=""}catch(e){console.error("Erreur lors de la récupération des numéros de modèle :",e)}});const M=async()=>{try{const a=await b.get("/api/brands");N.value=a.data.map(e=>e.brandValue)}catch(a){console.error("Erreur lors de la récupération des marques :",a)}},I=async()=>{try{let a=await b.get("/api/users/new_form");c.props.users=a.data.users;const e=new URLSearchParams(window.location.search);s.user_id||(s.user_id=e.get("user_id"))}catch(a){console.error("Error fetching users:",a)}},$=async()=>{try{let a=await b.get(`/api/devices/${w.value}/edit`);a.data.users&&(c.props.users=Object.entries(a.data.users).map(([e,t])=>({id:Number(e),name:t}))),a.data.device&&(s.image=a.data.device.image,s.user_id=a.data.device.user_id,s.brand=a.data.device.brand,s.model_name=a.data.device.model_name,s.model_number=a.data.device.model_number,s.color=a.data.device.color,s.serial_number=a.data.device.serial_number,s.imei=a.data.device.imei,s.description=a.data.device.description,s.returned=a.data.device.returned,s.has_service=!!a.data.device.has_service)}catch(a){console.error("Error fetching device data:",a)}},j=()=>{let a="/upload/no-image.jpg";return s.image&&(s.image.indexOf("base64")!=-1?a=s.image:a="/upload/"+s.image),a},B=a=>{const e=a.target;let t=e.files?e.files[0]:null;if(t){const x=new FileReader;x.onloadend=Ee=>{x.result&&(s.image=x.result)},x.readAsDataURL(t)}},L=(a,e)=>{p.value?R():O()},O=(a,e)=>{console.log("Form data being sent:",JSON.stringify(s,null,2)),b.post("/api/devices",s).then(t=>{E.fire({icon:"success",title:"Appareil ajouté",timer:2e3,showConfirmButton:!1}),setTimeout(()=>{F.Inertia.visit("/devices/index/")},2e3)}).catch(t=>{t.response&&t.response.status===422?n.value=t.response.data.errors:console.error("Error creating device:",t)}),console.log("Form data being sent:",JSON.stringify(s,null,2))},R=(a,e)=>{b.put(`/api/devices/${w.value}`,s).then(t=>{E.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{F.Inertia.visit("/devices/index/")},2e3)}).catch(t=>{t.response&&t.response.status===422?n.value=t.response.data.errors:console.error("Error creating device:",t)})};return(a,e)=>(o(),r(f,null,[C(m(W),{title:"Enregistrement Appareil"}),C(G,null,{header:D(()=>[i("h2",P,[p.value?(o(),r("span",Z,"Modification d'un appareil")):(o(),r("span",z,"Nouvel Appareil"))])]),default:D(()=>[i("div",H,[e[27]||(e[27]=i("div",{class:"devices__create__titlebar dflex justify-content-between align-items-center"},[i("div",{class:"devices__create__titlebar--item"},[i("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),i("div",K,[i("div",X,[i("div",Y,[_.value?u("",!0):(o(),r("div",ee,[e[10]||(e[10]=i("p",{class:"mb-1"},"Utilisateur",-1)),d(i("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"Rechercher un utilisateur...",class:"input mb-2"},null,512),[[g,k.value]]),d(i("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>s.user_id=t),class:"input",id:"user_id",name:"user_id"},[(o(!0),r(f,null,h(A.value,t=>(o(),r("option",{key:t.id,value:t.id},l(t.name),9,se))),128))],512),[[y,s.user_id]]),m(n).user_id?(o(),r("small",te,l(m(n).user_id),1)):u("",!0)])),!_.value||!p.value||_.value&&p.value&&!s.has_service?(o(),r("div",ie,[e[14]||(e[14]=i("p",{class:"mb-1"},"Marque",-1)),d(i("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>s.brand=t),class:"input"},[e[11]||(e[11]=i("option",{value:""},"Sélectionner une marque",-1)),(o(!0),r(f,null,h(N.value,t=>(o(),r("option",{key:t,value:t},l(t),9,ae))),128))],512),[[y,s.brand]]),m(n).brand?(o(),r("small",re,l(m(n).brand),1)):u("",!0),e[15]||(e[15]=i("p",{class:"mb-1"},"Modèle",-1)),d(i("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>s.model_name=t),class:"input",disabled:!s.brand},[e[12]||(e[12]=i("option",{value:""},"Sélectionner un modèle",-1)),(o(!0),r(f,null,h(S.value,t=>(o(),r("option",{key:t,value:t},l(t),9,le))),128))],8,oe),[[y,s.model_name]]),m(n).model_name?(o(),r("small",ne,l(m(n).model_name),1)):u("",!0),e[16]||(e[16]=i("p",{class:"mb-1"},"Numéro de modèle",-1)),d(i("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>s.model_number=t),class:"input",disabled:!s.model_name},[e[13]||(e[13]=i("option",{value:""},"Sélectionner un numéro de modèle",-1)),(o(!0),r(f,null,h(U.value,t=>(o(),r("option",{key:t,value:t},l(t),9,ue))),128))],8,de),[[y,s.model_number]]),m(n).model_number?(o(),r("small",me,l(m(n).model_number),1)):u("",!0),e[17]||(e[17]=i("p",{class:"mb-1"},"Couleur",-1)),d(i("input",{type:"text",class:"input",id:"color",name:"color","onUpdate:modelValue":e[5]||(e[5]=t=>s.color=t)},null,512),[[g,s.color]]),e[18]||(e[18]=i("p",{class:"mb-1"},"No de série",-1)),d(i("input",{type:"text",class:"input",id:"serial_number",name:"serial_number","onUpdate:modelValue":e[6]||(e[6]=t=>s.serial_number=t)},null,512),[[g,s.serial_number]]),e[19]||(e[19]=i("p",{class:"mb-1"},"imei",-1)),d(i("input",{type:"text",class:"input",id:"imei",name:"imei","onUpdate:modelValue":e[7]||(e[7]=t=>s.imei=t)},null,512),[[g,s.imei]]),e[20]||(e[20]=i("p",{class:"my-1"},"Description (optional)",-1)),d(i("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[8]||(e[8]=t=>s.description=t)},null,512),[[g,s.description]])])):u("",!0),_.value&&p.value&&s.has_service?(o(),r("div",ce,[i("p",pe,"Marque: "+l(s.brand),1),i("p",_e,"Nom de modèle: "+l(s.model_name),1),i("p",ve,"Numéro de modèle: "+l(s.model_number),1),i("p",be,"Couleur: "+l(s.color),1),i("p",fe,"Numéro de série: "+l(s.serial_number),1),i("p",ge,"imei: "+l(s.imei),1),i("p",ye,"Description: "+l(s.description),1)])):u("",!0),_.value?u("",!0):(o(),r("div",ke,[e[22]||(e[22]=i("p",{class:"mb-1"},"Restitué au client ?",-1)),d(i("select",{"onUpdate:modelValue":e[9]||(e[9]=t=>s.returned=t),class:"input",id:"returned",name:"returned",default:"0"},e[21]||(e[21]=[i("option",{value:"0"},"Non",-1),i("option",{value:"1"},"Oui",-1)]),512),[[y,s.returned]])])),_.value&&s.returned==0&&p.value?(o(),r("div",xe,e[23]||(e[23]=[i("p",null,"Appareil non restitué",-1)]))):u("",!0),_.value&&s.returned==1&&p.value?(o(),r("div",he,e[24]||(e[24]=[i("p",null,"Appareil restitué",-1)]))):u("",!0),i("div",we,[i("ul",Ue,[i("li",Ve,[i("div",Ne,[i("img",{src:j(),class:"devices__create__main--media--images--item--img",alt:""},null,8,Se)])]),i("li",Ae,[i("form",Ce,[e[25]||(e[25]=i("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),i("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:B},null,32)])])])])])])]),i("div",{class:"dflex justify-content-between align-items-center my-3"},[e[26]||(e[26]=i("p",null,null,-1)),i("button",{class:"btn btn-secondary",onClick:L},"Save")])])]),_:1})],64))}};export{Be as default};
