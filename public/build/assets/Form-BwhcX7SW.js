import{k as f,C as F,Q as M,m as T,D as m,f as d,a as h,u as r,w as x,F as b,o as n,Z as B,b as a,i as c,E as k,G as w,t as l,g as _,A as v,S}from"./app-XVC6Kbyu.js";import{_ as L}from"./AuthenticatedLayout-BFYNtHuA.js";import{d as V}from"./index-CfDzDjoZ.js";import"./ApplicationLogo-DE-QYPl_.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const O={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},R={key:0},$={key:1},P={class:"spares__create"},W={class:"spares__create__cardWrapper mt-2"},G={class:"spares__create__main"},Q={class:"spares__create__main--addInfo card py-2 px-2 bg-white"},Z=["value"],q={key:0,style:{color:"red"}},z=["value"],H={key:1,style:{color:"red"}},J={key:2,style:{color:"red"}},K={key:3,style:{color:"red"}},X={key:4,style:{color:"red"}},Y={key:5,style:{color:"red"}},ee={class:"devices__create__main--media--images mt-2"},se={class:"devices__create__main--media--images--list list-unstyled"},te={class:"devices__create__main--media--images--item"},ae={class:"devices__create__main--media--images--item--imgWrapper"},ie=["src"],re={class:"devices__create__main--media--images--item"},oe={class:"devices__create__main--media--images--item--form"},ue={__name:"Form",setup(de){const y=f(),i=F({image:"",service_id:"",spare_type_id:"",purchase_date:"",reception_date:"",description:""}),p=M(),g=f(!1);let o=f([]);T(()=>{p.props.route&&p.props.route.name==="spares.edit"?(g.value=!0,y.value=p.props.route.params.id,U()):(D(),E())});const D=async()=>{try{let t=await m.get("/api/services?all=true");p.props.services=t.data.services;const e=new URLSearchParams(window.location.search);i.service_id=e.get("service_id")}catch(t){console.error("Error fetching services:",t)}},E=async()=>{try{let t=await m.get("/api/spare_types?all=true");p.props.spare_types=t.data.spare_types}catch(t){console.error("Error fetching spare_types:",t)}},U=async()=>{try{let t=await m.get(`/api/spares/${y.value}/edit`);t.data.services&&(p.props.services=Object.entries(t.data.services).map(([e,s])=>({id:Number(e),description:s}))),t.data.spare_types&&(p.props.spare_types=Object.entries(t.data.spare_types).map(([e,s])=>({id:Number(e),type:s}))),t.data.spare&&(i.image=t.data.spare.image,i.service_id=t.data.spare.service_id,i.spare_type_id=t.data.spare.spare_type_id,i.description=t.data.spare.description,i.purchase_date=t.data.spare.purchase_date,i.reception_date=t.data.spare.reception_date,i.return_date=t.data.spare.return_date)}catch(t){console.error("Error fetching spare data:",t)}},j=()=>{let t="/upload/no-image.jpg";return i.image&&(i.image.indexOf("base64")!=-1?t=i.image:t="/upload/"+i.image),t},C=t=>{const e=t.target;let s=e.files?e.files[0]:null;if(s){const u=new FileReader;u.onloadend=ne=>{u.result&&(i.image=u.result)},u.readAsDataURL(s)}},I=(t,e)=>{g.value?A():N()},N=(t,e)=>{m.post("/api/spares",i).then(s=>{S.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{V.Inertia.visit("/spares/index/")},2e3)}).catch(s=>{s.response&&s.response.status===422?o.value=s.response.data.errors:console.error("Error creating spare:",s)})},A=(t,e)=>{m.put(`/api/spares/${y.value}`,i).then(s=>{S.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{V.Inertia.visit("/spares/index/")},2e3)}).catch(s=>{s.response.status===422?o.value=s.response.data.errors:console.error("Error creating spare:",s)})};return(t,e)=>(n(),d(b,null,[h(r(B),{title:"Enregistrement d'une pièce"}),h(L,null,{header:x(()=>[a("h2",O,[g.value?(n(),d("span",R,"Modification d'une pièce")):(n(),d("span",$,"Nouvelle pièce"))])]),default:x(()=>[a("div",P,[e[14]||(e[14]=a("div",{class:"spares__create__titlebar dflex justify-content-between align-items-center"},[a("div",{class:"spares__create__titlebar--item"},[a("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),a("div",W,[a("div",G,[a("div",Q,[e[7]||(e[7]=a("p",{class:"mb-1"},"Service",-1)),c(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.service_id=s),class:"input",id:"service_id",name:"service_id"},[(n(!0),d(b,null,w(r(p).props.services,s=>(n(),d("option",{key:s.id,value:s.id},l(s.device.user.name)+" -> "+l(s.device.brand)+" "+l(s.device.model_name)+" -> "+l(s.description),9,Z))),128))],512),[[k,i.service_id]]),r(o).service_id?(n(),d("small",q,l(r(o).service_id),1)):_("",!0),e[8]||(e[8]=a("p",{class:"mb-1"},"Pièce type",-1)),c(a("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.spare_type_id=s),class:"input",id:"spare_type_id",name:"spare_type_id"},[(n(!0),d(b,null,w(r(p).props.spare_types,s=>(n(),d("option",{key:s.id,value:s.id},l(s.dealer)+" "+l(s.type),9,z))),128))],512),[[k,i.spare_type_id]]),r(o).spare_type_id?(n(),d("small",H,l(r(o).spare_type_id),1)):_("",!0),e[9]||(e[9]=a("p",{class:"my-1"},"Description",-1)),c(a("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[2]||(e[2]=s=>i.description=s)},null,512),[[v,i.description]]),r(o).description?(n(),d("small",J,l(r(o).description),1)):_("",!0),e[10]||(e[10]=a("p",{class:"mb-1"},"Date d'achat",-1)),c(a("input",{type:"datetime-local",class:"input",id:"purchase_date",name:"purchase_date","onUpdate:modelValue":e[3]||(e[3]=s=>i.purchase_date=s)},null,512),[[v,i.purchase_date]]),r(o).purchase_date?(n(),d("small",K,l(r(o).purchase_date),1)):_("",!0),e[11]||(e[11]=a("p",{class:"mb-1"},"Date de reception",-1)),c(a("input",{type:"datetime-local",class:"input",id:"reception_date",name:"reception_date","onUpdate:modelValue":e[4]||(e[4]=s=>i.reception_date=s)},null,512),[[v,i.reception_date]]),r(o).reception_date?(n(),d("small",X,l(r(o).reception_date),1)):_("",!0),e[12]||(e[12]=a("p",{class:"mb-1"},"Date de retour",-1)),c(a("input",{type:"datetime-local",class:"input",id:"return_date",name:"return_date","onUpdate:modelValue":e[5]||(e[5]=s=>i.return_date=s)},null,512),[[v,i.return_date]]),r(o).return_date?(n(),d("small",Y,l(r(o).return_date),1)):_("",!0),a("div",ee,[a("ul",se,[a("li",te,[a("div",ae,[a("img",{src:j(),class:"devices__create__main--media--images--item--img",alt:""},null,8,ie)])]),a("li",re,[a("form",oe,[e[6]||(e[6]=a("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),a("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:C},null,32)])])])])])])]),a("div",{class:"dflex justify-content-between align-items-center my-3"},[e[13]||(e[13]=a("p",null,null,-1)),a("button",{class:"btn btn-secondary",onClick:I},"Save")])])]),_:1})],64))}};export{ue as default};
