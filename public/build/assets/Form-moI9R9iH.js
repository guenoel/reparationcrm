import{k as b,C as j,Q as L,m as R,h as B,l as O,D as y,f as r,a as k,u as m,w,F as U,o as n,Z as T,b as t,i as u,A as v,E as N,G as $,t as o,g as l,S as V}from"./app-BjlfKHe0.js";import{_ as q}from"./AuthenticatedLayout-BCFTJs8d.js";import{d as D}from"./index-D_lEM2AO.js";import"./ApplicationLogo-C3T5h9Va.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const Q={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},W={key:0},G={key:1},J={class:"devices__create"},P={class:"devices__create__cardWrapper mt-2"},Z={class:"devices__create__main"},z={class:"devices__create__main--addInfo card py-2 px-2 bg-white"},H={key:0},K=["value"],X={key:0,style:{color:"red"}},Y={key:1},ee={key:0,style:{color:"red"}},se={key:1,style:{color:"red"}},te={key:2,style:{color:"red"}},ie={key:2},ae={class:"mb-1"},re={class:"mb-1"},ne={class:"mb-1"},oe={class:"mb-1"},de={class:"mb-1"},le={class:"mb-1"},me={key:3},ue={key:4},ce={key:5},pe={class:"devices__create__main--media--images mt-2"},_e={class:"devices__create__main--media--images--list list-unstyled"},ve={class:"devices__create__main--media--images--item"},be={class:"devices__create__main--media--images--item--imgWrapper"},fe=["src"],ge={class:"devices__create__main--media--images--item"},ye={class:"devices__create__main--media--images--item--form"},De={__name:"Form",setup(xe){const x=b(),s=j({image:"",user_id:"",brand:"",model_name:"",model_number:"",serial_number:"",imei:"",description:"",returned:""}),c=L(),p=b(!1);let d=b([]);const _=b(!1),f=b("");R(()=>{const i=c.props.auth.user;i&&i.role===0&&(_.value=!0,s.user_id=i.id),c.props.route&&c.props.route.name==="devices.edit"?(p.value=!0,x.value=c.props.route.params.id,S()):A()});const h=B(()=>f.value.trim()?c.props.users.filter(i=>i.name.toLowerCase().includes(f.value.toLowerCase())):c.props.users);O(h,i=>{i.length>0&&(s.user_id=i[0].id)});const A=async()=>{try{let i=await y.get("/api/users/new_form");c.props.users=i.data.users;const e=new URLSearchParams(window.location.search);s.user_id||(s.user_id=e.get("user_id"))}catch(i){console.error("Error fetching users:",i)}},S=async()=>{try{let i=await y.get(`/api/devices/${x.value}/edit`);i.data.users&&(c.props.users=Object.entries(i.data.users).map(([e,a])=>({id:Number(e),name:a}))),i.data.device&&(s.image=i.data.device.image,s.user_id=i.data.device.user_id,s.brand=i.data.device.brand,s.model_name=i.data.device.model_name,s.model_number=i.data.device.model_number,s.serial_number=i.data.device.serial_number,s.imei=i.data.device.imei,s.description=i.data.device.description,s.returned=i.data.device.returned,s.has_service=!!i.data.device.has_service)}catch(i){console.error("Error fetching device data:",i)}},C=()=>{let i="/upload/no-image.jpg";return s.image&&(s.image.indexOf("base64")!=-1?i=s.image:i="/upload/"+s.image),i},M=i=>{const e=i.target;let a=e.files?e.files[0]:null;if(a){const g=new FileReader;g.onloadend=he=>{g.result&&(s.image=g.result)},g.readAsDataURL(a)}},E=(i,e)=>{p.value?I():F()},F=(i,e)=>{console.log("Form data being sent:",JSON.stringify(s,null,2)),y.post("/api/devices",s).then(a=>{V.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{D.Inertia.visit("/devices/index/")},2e3)}).catch(a=>{a.response&&a.response.status===422?d.value=a.response.data.errors:console.error("Error creating device:",a)})},I=(i,e)=>{y.put(`/api/devices/${x.value}`,s).then(a=>{V.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{D.Inertia.visit("/devices/index/")},2e3)}).catch(a=>{a.response.status===422?d.value=a.response.data.errors:console.error("Error creating device:",a)})};return(i,e)=>(n(),r(U,null,[k(m(T),{title:"Enregistrement Appareil"}),k(q,null,{header:w(()=>[t("h2",Q,[p.value?(n(),r("span",W,"Modification d'un appareil")):(n(),r("span",G,"Nouvel Appareil"))])]),default:w(()=>[t("div",J,[e[22]||(e[22]=t("div",{class:"devices__create__titlebar dflex justify-content-between align-items-center"},[t("div",{class:"devices__create__titlebar--item"},[t("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),t("div",P,[t("div",Z,[t("div",z,[_.value?l("",!0):(n(),r("div",H,[e[9]||(e[9]=t("p",{class:"mb-1"},"Utilisateur",-1)),u(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>f.value=a),placeholder:"Rechercher un utilisateur...",class:"input mb-2"},null,512),[[v,f.value]]),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>s.user_id=a),class:"input",id:"user_id",name:"user_id"},[(n(!0),r(U,null,$(h.value,a=>(n(),r("option",{key:a.id,value:a.id},o(a.name),9,K))),128))],512),[[N,s.user_id]]),m(d).user_id?(n(),r("small",X,o(m(d).user_id),1)):l("",!0)])),!_.value||!p.value||_.value&&p.value&&!s.has_service?(n(),r("div",Y,[e[10]||(e[10]=t("p",{class:"mb-1"},"Marque",-1)),u(t("input",{type:"text",class:"input",id:"brand",name:"brand","onUpdate:modelValue":e[2]||(e[2]=a=>s.brand=a)},null,512),[[v,s.brand]]),m(d).brand?(n(),r("small",ee,o(m(d).brand),1)):l("",!0),e[11]||(e[11]=t("p",{class:"mb-1"},"Modèle",-1)),u(t("input",{type:"text",class:"input",id:"model_name",name:"model_name","onUpdate:modelValue":e[3]||(e[3]=a=>s.model_name=a)},null,512),[[v,s.model_name]]),m(d).model_name?(n(),r("small",se,o(m(d).model_name),1)):l("",!0),e[12]||(e[12]=t("p",{class:"mb-1"},"No de modèle",-1)),u(t("input",{type:"text",class:"input",id:"model_number",name:"model_number","onUpdate:modelValue":e[4]||(e[4]=a=>s.model_number=a)},null,512),[[v,s.model_number]]),e[13]||(e[13]=t("p",{class:"mb-1"},"No de série",-1)),u(t("input",{type:"text",class:"input",id:"serial_number",name:"serial_number","onUpdate:modelValue":e[5]||(e[5]=a=>s.serial_number=a)},null,512),[[v,s.serial_number]]),e[14]||(e[14]=t("p",{class:"mb-1"},"imei",-1)),u(t("input",{type:"text",class:"input",id:"imei",name:"imei","onUpdate:modelValue":e[6]||(e[6]=a=>s.imei=a)},null,512),[[v,s.imei]]),e[15]||(e[15]=t("p",{class:"my-1"},"Description (optional)",-1)),u(t("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[7]||(e[7]=a=>s.description=a)},null,512),[[v,s.description]]),m(d).description?(n(),r("small",te,o(m(d).description),1)):l("",!0)])):l("",!0),_.value&&p.value&&s.has_service?(n(),r("div",ie,[t("p",ae,"Marque: "+o(s.brand),1),t("p",re,"Nom de modèle: "+o(s.model_name),1),t("p",ne,"Numéro de modèle: "+o(s.model_number),1),t("p",oe,"Numéro de série: "+o(s.serial_number),1),t("p",de,"imei: "+o(s.imei),1),t("p",le,"Description: "+o(s.description),1)])):l("",!0),_.value?l("",!0):(n(),r("div",me,[e[17]||(e[17]=t("p",{class:"mb-1"},"Restitué au client ?",-1)),u(t("select",{"onUpdate:modelValue":e[8]||(e[8]=a=>s.returned=a),class:"input",id:"returned",name:"returned"},e[16]||(e[16]=[t("option",{value:"0"},"Non",-1),t("option",{value:"1"},"Oui",-1)]),512),[[N,s.returned]])])),_.value&&s.returned==0&&p.value?(n(),r("div",ue,e[18]||(e[18]=[t("p",null,"Appareil non restitué",-1)]))):l("",!0),_.value&&s.returned==1&&p.value?(n(),r("div",ce,e[19]||(e[19]=[t("p",null,"Appareil restitué",-1)]))):l("",!0),t("div",pe,[t("ul",_e,[t("li",ve,[t("div",be,[t("img",{src:C(),class:"devices__create__main--media--images--item--img",alt:""},null,8,fe)])]),t("li",ge,[t("form",ye,[e[20]||(e[20]=t("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),t("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:M},null,32)])])])])])])]),t("div",{class:"dflex justify-content-between align-items-center my-3"},[e[21]||(e[21]=t("p",null,null,-1)),t("button",{class:"btn btn-secondary",onClick:E},"Save")])])]),_:1})],64))}};export{De as default};
