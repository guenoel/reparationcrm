import{k as v,C,Q as F,m as I,D as g,f as n,a as x,u as o,w,F as k,o as d,Z as j,b as s,i as m,E as B,G as L,t as c,g as p,A as u,S as U}from"./app-W_FqAoan.js";import{_ as O}from"./AuthenticatedLayout-CHPYlGl3.js";import{d as h}from"./index-YllimRi1.js";import"./ApplicationLogo-WdHHSFEO.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},T={key:0},$={key:1},W={class:"devices__create"},q={class:"devices__create__cardWrapper mt-2"},G={class:"devices__create__main"},J={class:"devices__create__main--addInfo card py-2 px-2 bg-white"},P={key:0},Q=["value"],Z={key:0,style:{color:"red"}},z={key:1,style:{color:"red"}},H={key:2,style:{color:"red"}},K={key:3,style:{color:"red"}},X={class:"devices__create__main--media--images mt-2"},Y={class:"devices__create__main--media--images--list list-unstyled"},ee={class:"devices__create__main--media--images--item"},se={class:"devices__create__main--media--images--item--imgWrapper"},ie=["src"],te={class:"devices__create__main--media--images--item"},ae={class:"devices__create__main--media--images--item--form"},ce={__name:"Form",setup(re){const f=v(),i=C({image:"",user_id:"",brand:"",model_name:"",model_number:"",serial_number:"",imei:"",description:""}),l=F(),b=v(!1);let r=v([]);const y=v(!1);I(()=>{const a=l.props.auth.user;a&&a.role===0&&(y.value=!0,i.user_id=a.id),l.props.route&&l.props.route.name==="devices.edit"?(b.value=!0,f.value=l.props.route.params.id,D()):V()});const V=async()=>{try{let a=await g.get("/api/users/new_form");l.props.users=a.data.users;const e=new URLSearchParams(window.location.search);i.user_id||(i.user_id=e.get("user_id"))}catch(a){console.error("Error fetching users:",a)}},D=async()=>{try{let a=await g.get(`/api/devices/${f.value}/edit`);a.data.users&&(l.props.users=Object.entries(a.data.users).map(([e,t])=>({id:Number(e),name:t}))),a.data.device&&(i.image=a.data.device.image,i.user_id=a.data.device.user_id,i.brand=a.data.device.brand,i.model_name=a.data.device.model_name,i.model_number=a.data.device.model_number,i.serial_number=a.data.device.serial_number,i.imei=a.data.device.imei,i.description=a.data.device.description)}catch(a){console.error("Error fetching device data:",a)}},S=()=>{let a="/upload/no-image.jpg";return i.image&&(i.image.indexOf("base64")!=-1?a=i.image:a="/upload/"+i.image),a},N=a=>{const e=a.target;let t=e.files?e.files[0]:null;if(t){const _=new FileReader;_.onloadend=ne=>{_.result&&(i.image=_.result)},_.readAsDataURL(t)}},A=(a,e)=>{b.value?M():E()},E=(a,e)=>{console.log("Form data being sent:",JSON.stringify(i,null,2)),g.post("/api/devices",i).then(t=>{U.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{h.Inertia.visit("/devices/index/")},2e3)}).catch(t=>{t.response&&t.response.status===422?r.value=t.response.data.errors:console.error("Error creating device:",t)})},M=(a,e)=>{g.put(`/api/devices/${f.value}`,i).then(t=>{U.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{h.Inertia.visit("/devices/index/")},2e3)}).catch(t=>{t.response.status===422?r.value=t.response.data.errors:console.error("Error creating device:",t)})};return(a,e)=>(d(),n(k,null,[x(o(j),{title:"Enregistrement Appareil"}),x(O,null,{header:w(()=>[s("h2",R,[b.value?(d(),n("span",T,"Modification d'un appareil")):(d(),n("span",$,"Nouvel Appareil"))])]),default:w(()=>[s("div",W,[e[16]||(e[16]=s("div",{class:"devices__create__titlebar dflex justify-content-between align-items-center"},[s("div",{class:"devices__create__titlebar--item"},[s("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),s("div",q,[s("div",G,[s("div",J,[y.value?p("",!0):(d(),n("div",P,[e[7]||(e[7]=s("p",{class:"mb-1"},"Utilisateur",-1)),m(s("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>i.user_id=t),class:"input",id:"user_id",name:"user_id"},[(d(!0),n(k,null,L(o(l).props.users,t=>(d(),n("option",{key:t.id,value:t.id},c(t.name),9,Q))),128))],512),[[B,i.user_id]]),o(r).user_id?(d(),n("small",Z,c(o(r).user_id),1)):p("",!0)])),e[9]||(e[9]=s("p",{class:"mb-1"},"Marque",-1)),m(s("input",{type:"text",class:"input",id:"brand",name:"brand","onUpdate:modelValue":e[1]||(e[1]=t=>i.brand=t)},null,512),[[u,i.brand]]),o(r).brand?(d(),n("small",z,c(o(r).brand),1)):p("",!0),e[10]||(e[10]=s("p",{class:"mb-1"},"Modèle",-1)),m(s("input",{type:"text",class:"input",id:"model_name",name:"model_name","onUpdate:modelValue":e[2]||(e[2]=t=>i.model_name=t)},null,512),[[u,i.model_name]]),o(r).model_name?(d(),n("small",H,c(o(r).model_name),1)):p("",!0),e[11]||(e[11]=s("p",{class:"mb-1"},"No de modèle",-1)),m(s("input",{type:"text",class:"input",id:"model_number",name:"model_number","onUpdate:modelValue":e[3]||(e[3]=t=>i.model_number=t)},null,512),[[u,i.model_number]]),e[12]||(e[12]=s("p",{class:"mb-1"},"No de série",-1)),m(s("input",{type:"text",class:"input",id:"serial_number",name:"serial_number","onUpdate:modelValue":e[4]||(e[4]=t=>i.serial_number=t)},null,512),[[u,i.serial_number]]),e[13]||(e[13]=s("p",{class:"mb-1"},"imei",-1)),m(s("input",{type:"text",class:"input",id:"imei",name:"imei","onUpdate:modelValue":e[5]||(e[5]=t=>i.imei=t)},null,512),[[u,i.imei]]),e[14]||(e[14]=s("p",{class:"my-1"},"Description (optional)",-1)),m(s("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[6]||(e[6]=t=>i.description=t)},null,512),[[u,i.description]]),o(r).description?(d(),n("small",K,c(o(r).description),1)):p("",!0),s("div",X,[s("ul",Y,[s("li",ee,[s("div",se,[s("img",{src:S(),class:"devices__create__main--media--images--item--img",alt:""},null,8,ie)])]),s("li",te,[s("form",ae,[e[8]||(e[8]=s("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),s("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:N},null,32)])])])])])])]),s("div",{class:"dflex justify-content-between align-items-center my-3"},[e[15]||(e[15]=s("p",null,null,-1)),s("button",{class:"btn btn-secondary",onClick:A},"Save")])])]),_:1})],64))}};export{ce as default};
