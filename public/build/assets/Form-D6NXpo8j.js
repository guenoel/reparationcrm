import{k as _,C as M,Q as A,m as T,D as f,f as r,a as b,u as n,w as k,F as g,o,Z as j,b as a,i as m,E as x,G as h,t as p,g as u,A as w,v as F,d as I,S}from"./app-D_F3Dni8.js";import{_ as B}from"./AuthenticatedLayout-DvWBs9vR.js";import{d as V}from"./index-BRJJwEmf.js";import"./ApplicationLogo-DgoA7lZD.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},$={key:0},L={key:1},O={class:"services__create"},P={class:"services__create__cardWrapper mt-2"},z={class:"services__create__main"},G={class:"services__create__main--addInfo card py-2 px-2 bg-white"},J=["value"],Q=["value"],W={key:2,style:{color:"red"}},Z={key:3,style:{color:"red"}},q={key:4},H={key:0,style:{color:"red"}},K={key:5},X={class:"my-1"},Y={key:6},ee={key:7},se={class:"mb-1"},te={key:8},de={__name:"Form",setup(ie){const y=_(),t=M({device_id:"",description:"",price:null,accepted:!1}),c=A(),d=_(!1);let l=_([]);const v=_(!1);T(()=>{const i=c.props.auth.user;i&&i.role===0&&(v.value=!0),c.props.route&&c.props.route.name==="services.edit"?(d.value=!0,y.value=c.props.route.params.id,E()):D()});const D=async()=>{try{let i=await f.get("/api/devices?all=true");console.log("Devices Response:",i.data.devices),c.props.devices=i.data.devices;const e=new URLSearchParams(window.location.search);t.device_id=e.get("device_id")}catch(i){console.error("Error fetching devices:",i)}},E=async()=>{try{let i=await f.get(`/api/services/${y.value}/edit`);console.log("Service Response:",i.data),i.data.devices&&(c.props.devices=Object.entries(i.data.devices).map(([e,s])=>({id:Number(e),label:s}))),i.data.service&&(t.device_id=i.data.service.device_id,t.description=i.data.service.description,t.price=i.data.service.price,t.accepted=i.data.service.accepted)}catch(i){console.error("Error fetching service data:",i)}},U=(i,e)=>{d.value?C():N()},N=(i,e)=>{f.post("/api/services",t).then(s=>{S.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{V.Inertia.visit("/services/index/")},2e3)}).catch(s=>{s.response&&s.response.status===422?l.value=s.response.data.errors:console.error("Error creating service:",s)}),console.log("Form data being sent:",JSON.stringify(t,null,2))},C=(i,e)=>{f.put(`/api/services/${y.value}`,t).then(s=>{S.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{V.Inertia.visit("/services/index/")},2e3)}).catch(s=>{s.response.status===422?l.value=s.response.data.errors:console.error("Error creating service:",s)})};return(i,e)=>(o(),r(g,null,[b(n(j),{title:"Enregistrement Appareil"}),b(B,null,{header:k(()=>[a("h2",R,[d.value?(o(),r("span",$,"Modification d'une prestation")):(o(),r("span",L,"Nouvelle prestation"))])]),default:k(()=>[a("div",O,[e[12]||(e[12]=a("div",{class:"services__create__titlebar dflex justify-content-between align-items-center"},[a("div",{class:"services__create__titlebar--item"},[a("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),a("div",P,[a("div",z,[a("div",G,[e[9]||(e[9]=a("p",{class:"mb-1"},"Appareil",-1)),d.value?m((o(),r("select",{key:0,"onUpdate:modelValue":e[0]||(e[0]=s=>t.device_id=s),class:"input",id:"device_id",name:"device_id"},[(o(!0),r(g,null,h(n(c).props.devices,s=>(o(),r("option",{key:s.id,value:s.id},p(s.label),9,J))),128))],512)),[[x,t.device_id]]):m((o(),r("select",{key:1,"onUpdate:modelValue":e[1]||(e[1]=s=>t.device_id=s),class:"input",id:"device_id",name:"device_id"},[(o(!0),r(g,null,h(n(c).props.devices,s=>(o(),r("option",{key:s.id,value:s.id},p(s.user.name)+" - "+p(s.brand)+" "+p(s.model_name),9,Q))),128))],512)),[[x,t.device_id]]),n(l).device_id?(o(),r("small",W,p(n(l).device_id),1)):u("",!0),e[10]||(e[10]=a("p",{class:"my-1"},"Description du service demandé",-1)),m(a("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[2]||(e[2]=s=>t.description=s)},null,512),[[w,t.description]]),n(l).description?(o(),r("small",Z,p(n(l).description),1)):u("",!0),v.value?u("",!0):(o(),r("div",q,[e[5]||(e[5]=a("p",{class:"mb-1"},"Prix",-1)),m(a("input",{type:"text",class:"input",id:"price",name:"price","onUpdate:modelValue":e[3]||(e[3]=s=>t.price=s)},null,512),[[w,t.price]]),n(l).price?(o(),r("small",H,p(n(l).price),1)):u("",!0)])),v.value&&d.value&&t.price!=null?(o(),r("div",K,[a("p",X,"Tarif: "+p(t.price),1)])):u("",!0),d.value&&t.price==null?(o(),r("div",Y,e[6]||(e[6]=[a("p",{class:"mb-1"},"En attente d'un tarif",-1)]))):u("",!0),v.value&&d.value&&t.accepted==!1&&t.price!=null?(o(),r("div",ee,[a("p",se,[m(a("input",{type:"checkbox",id:"accepted",name:"accepted","onUpdate:modelValue":e[4]||(e[4]=s=>t.accepted=s)},null,512),[[F,t.accepted]]),e[7]||(e[7]=I(" Cochez la case pour accepter le devis"))])])):u("",!0),v.value&&d.value&&t.accepted==!0?(o(),r("div",te,e[8]||(e[8]=[a("p",{class:"my-1"},"Devis accepté",-1)]))):u("",!0)])])]),a("div",{class:"dflex justify-content-between align-items-center my-3"},[e[11]||(e[11]=a("p",null,null,-1)),a("button",{class:"btn btn-secondary",onClick:U},"Save")])])]),_:1})],64))}};export{de as default};
