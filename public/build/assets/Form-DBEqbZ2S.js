import{k as f,C as T,Q as M,m as R,D as p,f as d,a as h,u as r,w as b,F as k,o as l,Z as $,b as a,i as _,E as w,G as x,t as c,g as m,A as y,S}from"./app-sx8I9MJF.js";import{_ as L}from"./AuthenticatedLayout-D6jzmdd-.js";import{d as E}from"./index-WYmgruwZ.js";import"./ApplicationLogo-UVF1Jj2f.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const B={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},O={key:0},P={key:1},W={class:"tasks__create"},G={class:"tasks__create__cardWrapper mt-2"},Q={class:"tasks__create__main"},Z={class:"tasks__create__main--addInfo card py-2 px-2 bg-white"},q=["value"],z={key:0,style:{color:"red"}},H=["value"],J={key:1,style:{color:"red"}},K={key:2,style:{color:"red"}},X={key:3,style:{color:"red"}},Y={key:4,style:{color:"red"}},ee={class:"devices__create__main--media--images mt-2"},se={class:"devices__create__main--media--images--list list-unstyled"},te={class:"devices__create__main--media--images--item"},ae={class:"devices__create__main--media--images--item--imgWrapper"},ie=["src"],re={class:"devices__create__main--media--images--item"},oe={class:"devices__create__main--media--images--item--form"},ue={__name:"Form",setup(ne){const v=f(),i=T({service_id:"",spare_ids:[],start:"",end:"",description:""}),o=M(),g=f(!1);let n=f([]);R(()=>{o.props.route&&o.props.route.name==="tasks.edit"?(g.value=!0,v.value=o.props.route.params.id,D()):(U(),V(),A())});const U=async()=>{try{let t=await p.get("/api/services?all=true");o.props.services=t.data.services;const e=new URLSearchParams(window.location.search);i.service_id=e.get("service_id")}catch(t){console.error("Error fetching services:",t)}},V=async()=>{try{const t=new URLSearchParams(window.location.search);if(i.service_id=t.get("service_id"),!i.service_id){console.error("Service ID is missing, unable to fetch spares.");return}let e=await p.get(`/api/spares?service_id=${i.service_id}`);o.props.spares=e.data.spares.data||[],console.log("Fetched spares:",o.props.spares)}catch(t){console.error("Error fetching spares:",t)}},A=async()=>{try{i.user_id=o.props.auth.user.id}catch(t){console.error("Error fetching user:",t)}},D=async()=>{try{let t=await p.get(`/api/tasks/${v.value}/edit`);if(t.data.services&&(o.props.services=Object.entries(t.data.services).map(([e,s])=>({id:Number(e),description:s}))),t.data.spares&&(o.props.spares=Object.entries(t.data.spares).map(([e,s])=>({id:Number(e),description:s}))),t.data.task){i.service_id=t.data.task.service_id,i.user_id=t.data.task.user_id,i.spare_ids=t.data.task.spares.map(s=>s.id)||[],i.start=t.data.task.start,i.end=t.data.task.end,i.description=t.data.task.description;const e=await p.get(`/api/spares?service_id=${i.service_id}`);o.props.spares=e.data.spares.data||[]}}catch(t){console.error("Error fetching task data:",t)}},F=()=>{let t="/upload/no-image.jpg";return i.image&&(i.image.indexOf("base64")!=-1?t=i.image:t="/upload/"+i.image),t},I=t=>{const e=t.target;let s=e.files?e.files[0]:null;if(s){const u=new FileReader;u.onloadend=de=>{u.result&&(i.image=u.result)},u.readAsDataURL(s)}},j=(t,e)=>{g.value?N():C()},C=(t,e)=>{p.post("/api/tasks",i).then(s=>{S.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{E.Inertia.visit("/tasks/index/")},2e3)}).catch(s=>{s.response&&s.response.status===422?n.value=s.response.data.errors:console.error("Error creating task:",s)})},N=(t,e)=>{p.put(`/api/tasks/${v.value}`,i).then(s=>{S.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{E.Inertia.visit("/tasks/index/")},2e3)}).catch(s=>{s.response.status===422?n.value=s.response.data.errors:console.error("Error creating task:",s)})};return(t,e)=>(l(),d(k,null,[h(r($),{title:"Enregistrement d'une tâche"}),h(L,null,{header:b(()=>[a("h2",B,[g.value?(l(),d("span",O,"Modification d'une tâche")):(l(),d("span",P,"Nouvelle tâche"))])]),default:b(()=>[a("div",W,[e[12]||(e[12]=a("div",{class:"tasks__create__titlebar dflex justify-content-between align-items-center"},[a("div",{class:"tasks__create__titlebar--item"},[a("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),a("div",G,[a("div",Q,[a("div",Z,[e[6]||(e[6]=a("p",{class:"mb-1"},"Service",-1)),_(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.service_id=s),class:"input",id:"service_id",name:"service_id"},[(l(!0),d(k,null,x(r(o).props.services,s=>(l(),d("option",{key:s.id,value:s.id},c(s.description),9,q))),128))],512),[[w,i.service_id]]),r(n).service_id?(l(),d("small",z,c(r(n).service_id),1)):m("",!0),e[7]||(e[7]=a("p",{class:"mb-1"},"Pièces",-1)),_(a("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.spare_ids=s),class:"input",id:"spare_ids",name:"spare_ids",multiple:""},[Array.isArray(r(o).props.spares)&&r(o).props.spares.length>0?(l(!0),d(k,{key:0},x(r(o).props.spares,s=>(l(),d("option",{key:s.id,value:s.id},c(s.description),9,H))),128)):m("",!0)],512),[[w,i.spare_ids]]),r(n).spare_ids?(l(),d("small",J,c(r(n).spare_ids),1)):m("",!0),e[8]||(e[8]=a("p",{class:"mb-1"},"Début de la tâche",-1)),_(a("input",{type:"datetime-local",class:"input",id:"start",name:"start","onUpdate:modelValue":e[2]||(e[2]=s=>i.start=s)},null,512),[[y,i.start]]),r(n).start?(l(),d("small",K,c(r(n).start),1)):m("",!0),e[9]||(e[9]=a("p",{class:"mb-1"},"Fin de la tâche",-1)),_(a("input",{type:"datetime-local",class:"input",id:"end",name:"end","onUpdate:modelValue":e[3]||(e[3]=s=>i.end=s)},null,512),[[y,i.end]]),r(n).end?(l(),d("small",X,c(r(n).end),1)):m("",!0),e[10]||(e[10]=a("p",{class:"my-1"},"Description",-1)),_(a("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[4]||(e[4]=s=>i.description=s)},null,512),[[y,i.description]]),r(n).description?(l(),d("small",Y,c(r(n).description),1)):m("",!0),a("div",ee,[a("ul",se,[a("li",te,[a("div",ae,[a("img",{src:F(),class:"devices__create__main--media--images--item--img",alt:""},null,8,ie)])]),a("li",re,[a("form",oe,[e[5]||(e[5]=a("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),a("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:I},null,32)])])])])])])]),a("div",{class:"dflex justify-content-between align-items-center my-3"},[e[11]||(e[11]=a("p",null,null,-1)),a("button",{class:"btn btn-secondary",onClick:j},"Save")])])]),_:1})],64))}};export{ue as default};
