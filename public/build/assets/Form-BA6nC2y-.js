import{k as u,C as W,Q as z,m as G,h as Z,l as D,D as g,f as o,a as C,u as m,w as E,F as y,o as r,Z as K,b as i,i as c,A as h,E as k,g as n,t as l,G as x,S as $}from"./app-BVjjO1PS.js";import{_ as P}from"./AuthenticatedLayout-CZyxdBTE.js";import{d as F}from"./index-D0HmWNPP.js";import"./ApplicationLogo-BR4P48Mj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const X={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},Y={key:0},ee={key:1},se={class:"devices__create"},te={class:"devices__create__cardWrapper mt-2"},ae={class:"devices__create__main"},ie={class:"devices__create__main--addInfo card py-2 px-2 bg-white"},oe={key:0},re={key:0,class:"absolute w-full bg-white border rounded shadow-lg z-10"},le=["onMousedown","innerHTML"],ne={key:1,style:{color:"red"}},de={key:1},ue=["value"],me={key:0,style:{color:"red"}},ce=["disabled"],pe=["value"],_e={key:1,style:{color:"red"}},ve=["disabled"],be=["value"],ge={key:2,style:{color:"red"}},fe={key:2},ye={class:"mb-1"},he={class:"mb-1"},we={class:"mb-1"},ke={class:"mb-1"},xe={class:"mb-1"},Ue={class:"mb-1"},Ne={class:"mb-1"},Ve={key:3},De={key:4},Me={key:5},Se={class:"devices__create__main--media--images mt-2"},Ae={class:"devices__create__main--media--images--list list-unstyled"},Ce={class:"devices__create__main--media--images--item"},Ee={class:"devices__create__main--media--images--item--imgWrapper"},$e=["src"],Fe={class:"devices__create__main--media--images--item"},Le={class:"devices__create__main--media--images--item--form"},He={__name:"Form",setup(Be){const U=u(),s=W({image:"",user_id:"",brand:"",model_name:"",model_number:"",color:"",serial_number:"",imei:"",description:"",returned:""}),v=z(),p=u(!1);let d=u([]);const _=u(!1),b=u(""),M=u([]),S=u([]),N=u([]),A=u(!1),w=u(!1);G(()=>{const t=v.props.auth.user;t&&t.role===0&&(_.value=!0,s.user_id=t.id),v.props.route&&v.props.route.name==="devices.edit"?(p.value=!0,U.value=v.props.route.params.id,j()):(T(),O())});const V=Z(()=>b.value.trim()?v.props.users.filter(t=>t.name.toLowerCase().includes(b.value.toLowerCase())):[]),L=t=>{s.user_id=t.id,b.value=t.name,w.value=!1},B=()=>{setTimeout(()=>{w.value=!1},200)},I=t=>{if(!b.value)return t;const e=new RegExp(`(${b.value})`,"gi");return t.replace(e,'<span class="bg-yellow-300">$1</span>')};D(V,t=>{t.length>0&&(s.user_id=t[0].id)}),D(()=>s.brand,async t=>{if(t)try{const e=await g.get(`/api/models/${t}`);S.value=e.data.map(a=>a.modelValue),s.model_name="",N.value=[]}catch(e){console.error("Erreur lors de la récupération des noms de modèle :",e)}}),D(()=>s.model_name,async t=>{if(t)try{const e=await g.get(`/api/model-numbers/${s.brand}/${t}`);N.value=Array.isArray(e.data)?e.data:[],s.model_number=""}catch(e){console.error("Erreur lors de la récupération des numéros de modèle :",e)}});const O=async()=>{try{const t=await g.get("/api/brands");M.value=t.data.map(e=>e.brandValue)}catch(t){console.error("Erreur lors de la récupération des marques :",t)}},T=async()=>{try{A.value=!0;let t=await g.get("/api/users/new_form");v.props.users=t.data.users}catch(t){console.error("Error fetching users:",t)}finally{A.value=!1}},j=async()=>{try{let t=await g.get(`/api/devices/${U.value}/edit`);t.data.users&&(v.props.users=Object.entries(t.data.users).map(([e,a])=>({id:Number(e),name:a}))),t.data.device&&(s.image=t.data.device.image,s.user_id=t.data.device.user_id,s.brand=t.data.device.brand,s.model_name=t.data.device.model_name,s.model_number=t.data.device.model_number,s.color=t.data.device.color,s.serial_number=t.data.device.serial_number,s.imei=t.data.device.imei,s.description=t.data.device.description,s.returned=t.data.device.returned,s.has_service=!!t.data.device.has_service)}catch(t){console.error("Error fetching device data:",t)}},R=()=>{let t="/upload/no-image.jpg";return s.image&&(s.image.indexOf("base64")!=-1?t=s.image:t="/upload/"+s.image),t},q=t=>{const e=t.target;let a=e.files?e.files[0]:null;if(a){const f=new FileReader;f.onloadend=Ie=>{f.result&&(s.image=f.result)},f.readAsDataURL(a)}},H=(t,e)=>{p.value?Q():J()},J=(t,e)=>{console.log("Form data being sent:",JSON.stringify(s,null,2)),g.post("/api/devices",s).then(a=>{$.fire({icon:"success",title:"Appareil ajouté",timer:2e3,showConfirmButton:!1}),setTimeout(()=>{F.Inertia.visit("/devices/index/")},2e3)}).catch(a=>{a.response&&a.response.status===422?d.value=a.response.data.errors:console.error("Error creating device:",a)}),console.log("Form data being sent:",JSON.stringify(s,null,2))},Q=(t,e)=>{g.put(`/api/devices/${U.value}`,s).then(a=>{$.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{F.Inertia.visit("/devices/index/")},2e3)}).catch(a=>{a.response&&a.response.status===422?d.value=a.response.data.errors:console.error("Error creating device:",a)})};return(t,e)=>(r(),o(y,null,[C(m(K),{title:"Enregistrement Appareil"}),C(P,null,{header:E(()=>[i("h2",X,[p.value?(r(),o("span",Y,"Modification d'un appareil")):(r(),o("span",ee,"Nouvel Appareil"))])]),default:E(()=>[i("div",se,[e[27]||(e[27]=i("div",{class:"devices__create__titlebar dflex justify-content-between align-items-center"},[i("div",{class:"devices__create__titlebar--item"},[i("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),i("div",te,[i("div",ae,[i("div",ie,[_.value?n("",!0):(r(),o("div",oe,[e[10]||(e[10]=i("p",{class:"mb-1"},"Utilisateur",-1)),c(i("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>b.value=a),placeholder:"Rechercher un utilisateur...",class:"input mb-2 w-full",onFocus:e[1]||(e[1]=a=>w.value=!0),onBlur:B},null,544),[[h,b.value]]),w.value&&V.value.length?(r(),o("div",re,[i("ul",null,[(r(!0),o(y,null,k(V.value,a=>(r(),o("li",{key:a.id,onMousedown:f=>L(a),class:"p-2 hover:bg-gray-200 cursor-pointer",innerHTML:I(a.name)},null,40,le))),128))])])):n("",!0),m(d).user_id?(r(),o("small",ne,l(m(d).user_id),1)):n("",!0)])),!_.value||!p.value||_.value&&p.value&&!s.has_service?(r(),o("div",de,[e[14]||(e[14]=i("p",{class:"mb-1"},"Marque",-1)),c(i("select",{"onUpdate:modelValue":e[2]||(e[2]=a=>s.brand=a),class:"input"},[e[11]||(e[11]=i("option",{value:""},"Sélectionner une marque",-1)),(r(!0),o(y,null,k(M.value,a=>(r(),o("option",{key:a,value:a},l(a),9,ue))),128))],512),[[x,s.brand]]),m(d).brand?(r(),o("small",me,l(m(d).brand),1)):n("",!0),e[15]||(e[15]=i("p",{class:"mb-1"},"Modèle",-1)),c(i("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>s.model_name=a),class:"input",disabled:!s.brand},[e[12]||(e[12]=i("option",{value:""},"Sélectionner un modèle",-1)),(r(!0),o(y,null,k(S.value,a=>(r(),o("option",{key:a,value:a},l(a),9,pe))),128))],8,ce),[[x,s.model_name]]),m(d).model_name?(r(),o("small",_e,l(m(d).model_name),1)):n("",!0),e[16]||(e[16]=i("p",{class:"mb-1"},"Numéro de modèle",-1)),c(i("select",{"onUpdate:modelValue":e[4]||(e[4]=a=>s.model_number=a),class:"input",disabled:!s.model_name},[e[13]||(e[13]=i("option",{value:""},"Sélectionner un numéro de modèle",-1)),(r(!0),o(y,null,k(N.value,a=>(r(),o("option",{key:a,value:a},l(a),9,be))),128))],8,ve),[[x,s.model_number]]),m(d).model_number?(r(),o("small",ge,l(m(d).model_number),1)):n("",!0),e[17]||(e[17]=i("p",{class:"mb-1"},"Couleur",-1)),c(i("input",{type:"text",class:"input",id:"color",name:"color","onUpdate:modelValue":e[5]||(e[5]=a=>s.color=a)},null,512),[[h,s.color]]),e[18]||(e[18]=i("p",{class:"mb-1"},"No de série",-1)),c(i("input",{type:"text",class:"input",id:"serial_number",name:"serial_number","onUpdate:modelValue":e[6]||(e[6]=a=>s.serial_number=a)},null,512),[[h,s.serial_number]]),e[19]||(e[19]=i("p",{class:"mb-1"},"imei",-1)),c(i("input",{type:"text",class:"input",id:"imei",name:"imei","onUpdate:modelValue":e[7]||(e[7]=a=>s.imei=a)},null,512),[[h,s.imei]]),e[20]||(e[20]=i("p",{class:"my-1"},"Description (optional)",-1)),c(i("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[8]||(e[8]=a=>s.description=a)},null,512),[[h,s.description]])])):n("",!0),_.value&&p.value&&s.has_service?(r(),o("div",fe,[i("p",ye,"Marque: "+l(s.brand),1),i("p",he,"Nom de modèle: "+l(s.model_name),1),i("p",we,"Numéro de modèle: "+l(s.model_number),1),i("p",ke,"Couleur: "+l(s.color),1),i("p",xe,"Numéro de série: "+l(s.serial_number),1),i("p",Ue,"imei: "+l(s.imei),1),i("p",Ne,"Description: "+l(s.description),1)])):n("",!0),_.value?n("",!0):(r(),o("div",Ve,[e[22]||(e[22]=i("p",{class:"mb-1"},"Restitué au client ?",-1)),c(i("select",{"onUpdate:modelValue":e[9]||(e[9]=a=>s.returned=a),class:"input",id:"returned",name:"returned",default:"0"},e[21]||(e[21]=[i("option",{value:"0"},"Non",-1),i("option",{value:"1"},"Oui",-1)]),512),[[x,s.returned]])])),_.value&&s.returned==0&&p.value?(r(),o("div",De,e[23]||(e[23]=[i("p",null,"Appareil non restitué",-1)]))):n("",!0),_.value&&s.returned==1&&p.value?(r(),o("div",Me,e[24]||(e[24]=[i("p",null,"Appareil restitué",-1)]))):n("",!0),i("div",Se,[i("ul",Ae,[i("li",Ce,[i("div",Ee,[i("img",{src:R(),class:"devices__create__main--media--images--item--img",alt:""},null,8,$e)])]),i("li",Fe,[i("form",Le,[e[25]||(e[25]=i("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),i("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:q},null,32)])])])])])])]),i("div",{class:"dflex justify-content-between align-items-center my-3"},[e[26]||(e[26]=i("p",null,null,-1)),i("button",{class:"btn btn-secondary",onClick:H},"Save")])])]),_:1})],64))}};export{He as default};
