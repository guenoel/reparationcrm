import{k as m,C as U,Q as C,m as M,D as _,f as r,a as g,u as n,w as b,F as x,o,Z as A,b as a,i as f,E as T,G as j,t as u,g as d,A as h,v as F,d as I,S as k}from"./app-CvlGNgtx.js";import{_ as B}from"./AuthenticatedLayout-jDvLViWn.js";import{d as w}from"./index-DR96bYUP.js";import"./ApplicationLogo-DviQ4QPo.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const R={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},$={key:0},L={key:1},O={class:"services__create"},P={class:"services__create__cardWrapper mt-2"},z={class:"services__create__main"},G={class:"services__create__main--addInfo card py-2 px-2 bg-white"},J=["value"],Q={key:0,style:{color:"red"}},W={key:1,style:{color:"red"}},Z={key:2},q={key:0,style:{color:"red"}},H={key:3},K={class:"my-1"},X={key:4},Y={key:5},ee={class:"mb-1"},se={key:6},ne={__name:"Form",setup(te){const y=m(),t=U({device_id:"",description:"",price:null,accepted:!1}),l=C(),p=m(!1);let c=m([]);const v=m(!1);M(()=>{const i=l.props.auth.user;i&&i.role===0&&(v.value=!0),l.props.route&&l.props.route.name==="services.edit"?(p.value=!0,y.value=l.props.route.params.id,D()):S()});const S=async()=>{try{let i=await _.get("/api/devices?all=true");console.log("Devices Response:",i.data.devices),l.props.devices=i.data.devices;const e=new URLSearchParams(window.location.search);t.device_id=e.get("device_id")}catch(i){console.error("Error fetching devices:",i)}},D=async()=>{try{let i=await _.get(`/api/services/${y.value}/edit`);console.log("Service Response:",i.data),i.data.devices&&(l.props.devices=Object.entries(i.data.devices).map(([e,s])=>({id:Number(e),label:s}))),i.data.service&&(t.device_id=i.data.service.device_id,t.description=i.data.service.description,t.price=i.data.service.price,t.accepted=i.data.service.accepted)}catch(i){console.error("Error fetching service data:",i)}},E=(i,e)=>{p.value?N():V()},V=(i,e)=>{_.post("/api/services",t).then(s=>{k.fire({icon:"success",title:"Appareil ajouté"}),setTimeout(()=>{w.Inertia.visit("/services/index/")},2e3)}).catch(s=>{s.response&&s.response.status===422?c.value=s.response.data.errors:console.error("Error creating service:",s)}),console.log("Form data being sent:",JSON.stringify(t,null,2))},N=(i,e)=>{_.put(`/api/services/${y.value}`,t).then(s=>{k.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{w.Inertia.visit("/services/index/")},2e3)}).catch(s=>{s.response.status===422?c.value=s.response.data.errors:console.error("Error creating service:",s)})};return(i,e)=>(o(),r(x,null,[g(n(A),{title:"Enregistrement Appareil"}),g(B,null,{header:b(()=>[a("h2",R,[p.value?(o(),r("span",$,"Modification d'une prestation")):(o(),r("span",L,"Nouvelle prestation"))])]),default:b(()=>[a("div",O,[e[11]||(e[11]=a("div",{class:"services__create__titlebar dflex justify-content-between align-items-center"},[a("div",{class:"services__create__titlebar--item"},[a("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),a("div",P,[a("div",z,[a("div",G,[e[8]||(e[8]=a("p",{class:"mb-1"},"Appareil",-1)),f(a("select",{"onUpdate:modelValue":e[0]||(e[0]=s=>t.device_id=s),class:"input",id:"device_id",name:"device_id"},[(o(!0),r(x,null,j(n(l).props.devices,s=>(o(),r("option",{key:s.id,value:s.id},u(s.label),9,J))),128))],512),[[T,t.device_id]]),n(c).device_id?(o(),r("small",Q,u(n(c).device_id),1)):d("",!0),e[9]||(e[9]=a("p",{class:"my-1"},"Description du service demandé",-1)),f(a("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[1]||(e[1]=s=>t.description=s)},null,512),[[h,t.description]]),n(c).description?(o(),r("small",W,u(n(c).description),1)):d("",!0),v.value?d("",!0):(o(),r("div",Z,[e[4]||(e[4]=a("p",{class:"mb-1"},"Prix",-1)),f(a("input",{type:"text",class:"input",id:"price",name:"price","onUpdate:modelValue":e[2]||(e[2]=s=>t.price=s)},null,512),[[h,t.price]]),n(c).price?(o(),r("small",q,u(n(c).price),1)):d("",!0)])),v.value&&p.value&&t.price!=null?(o(),r("div",H,[a("p",K,"Tarif: "+u(t.price),1)])):d("",!0),p.value&&t.price==null?(o(),r("div",X,e[5]||(e[5]=[a("p",{class:"mb-1"},"En attente d'un tarif",-1)]))):d("",!0),v.value&&p.value&&t.accepted==!1&&t.price!=null?(o(),r("div",Y,[a("p",ee,[f(a("input",{type:"checkbox",id:"accepted",name:"accepted","onUpdate:modelValue":e[3]||(e[3]=s=>t.accepted=s)},null,512),[[F,t.accepted]]),e[6]||(e[6]=I(" Cochez la case pour accepter le devis"))])])):d("",!0),v.value&&p.value&&t.accepted==!0?(o(),r("div",se,e[7]||(e[7]=[a("p",{class:"my-1"},"Devis accepté",-1)]))):d("",!0)])])]),a("div",{class:"dflex justify-content-between align-items-center my-3"},[e[10]||(e[10]=a("p",null,null,-1)),a("button",{class:"btn btn-secondary",onClick:E},"Save")])])]),_:1})],64))}};export{ne as default};
