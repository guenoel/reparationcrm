import{k as b,C as j,Q as B,m as L,h as O,l as R,D as y,f as r,a as h,u as v,w as k,F as U,o,Z as T,b as t,i as l,A as _,E as N,G as $,t as n,g as d,S as V}from"./app-CWrOUGrC.js";import{_ as q}from"./AuthenticatedLayout-DSwbZh_W.js";import{d as C}from"./index-BtVjSjZl.js";import"./ApplicationLogo-DChB-njM.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"text-xl font-semibold leading-tight text-gray-800 dark:text-gray-200"},Q={key:0},W={key:1},G={class:"devices__create"},P={class:"devices__create__cardWrapper mt-2"},Z={class:"devices__create__main"},z={class:"devices__create__main--addInfo card py-2 px-2 bg-white"},H={key:0},K=["value"],X={key:0,style:{color:"red"}},Y={key:1},ee={key:0,style:{color:"red"}},se={key:1,style:{color:"red"}},te={key:2},ie={class:"mb-1"},ae={class:"mb-1"},re={class:"mb-1"},oe={class:"mb-1"},ne={class:"mb-1"},le={class:"mb-1"},de={class:"mb-1"},me={key:3},ue={key:4},ce={key:5},pe={class:"devices__create__main--media--images mt-2"},_e={class:"devices__create__main--media--images--list list-unstyled"},ve={class:"devices__create__main--media--images--item"},be={class:"devices__create__main--media--images--item--imgWrapper"},fe=["src"],ge={class:"devices__create__main--media--images--item"},ye={class:"devices__create__main--media--images--item--form"},Ce={__name:"Form",setup(xe){const x=b(),s=j({image:"",user_id:"",brand:"",model_name:"",model_number:"",color:"",serial_number:"",imei:"",description:"",returned:""}),m=B(),u=b(!1);let c=b([]);const p=b(!1),f=b("");L(()=>{const a=m.props.auth.user;a&&a.role===0&&(p.value=!0,s.user_id=a.id),m.props.route&&m.props.route.name==="devices.edit"?(u.value=!0,x.value=m.props.route.params.id,S()):D()});const w=O(()=>f.value.trim()?m.props.users.filter(a=>a.name.toLowerCase().includes(f.value.toLowerCase())):m.props.users);R(w,a=>{a.length>0&&(s.user_id=a[0].id)});const D=async()=>{try{let a=await y.get("/api/users/new_form");m.props.users=a.data.users;const e=new URLSearchParams(window.location.search);s.user_id||(s.user_id=e.get("user_id"))}catch(a){console.error("Error fetching users:",a)}},S=async()=>{try{let a=await y.get(`/api/devices/${x.value}/edit`);a.data.users&&(m.props.users=Object.entries(a.data.users).map(([e,i])=>({id:Number(e),name:i}))),a.data.device&&(s.image=a.data.device.image,s.user_id=a.data.device.user_id,s.brand=a.data.device.brand,s.model_name=a.data.device.model_name,s.model_number=a.data.device.model_number,s.color=a.data.device.color,s.serial_number=a.data.device.serial_number,s.imei=a.data.device.imei,s.description=a.data.device.description,s.returned=a.data.device.returned,s.has_service=!!a.data.device.has_service)}catch(a){console.error("Error fetching device data:",a)}},A=()=>{let a="/upload/no-image.jpg";return s.image&&(s.image.indexOf("base64")!=-1?a=s.image:a="/upload/"+s.image),a},M=a=>{const e=a.target;let i=e.files?e.files[0]:null;if(i){const g=new FileReader;g.onloadend=we=>{g.result&&(s.image=g.result)},g.readAsDataURL(i)}},E=(a,e)=>{u.value?I():F()},F=(a,e)=>{console.log("Form data being sent:",JSON.stringify(s,null,2)),y.post("/api/devices",s).then(i=>{V.fire({icon:"success",title:"Appareil ajouté",timer:2e3,showConfirmButton:!1}),setTimeout(()=>{C.Inertia.visit("/devices/index/")},2e3)}).catch(i=>{i.response&&i.response.status===422?c.value=i.response.data.errors:console.error("Error creating device:",i)}),console.log("Form data being sent:",JSON.stringify(s,null,2))},I=(a,e)=>{y.put(`/api/devices/${x.value}`,s).then(i=>{V.fire({icon:"success",title:"Appareil modifié"}),setTimeout(()=>{C.Inertia.visit("/devices/index/")},2e3)}).catch(i=>{i.response&&i.response.status===422?c.value=i.response.data.errors:console.error("Error creating device:",i)})};return(a,e)=>(o(),r(U,null,[h(v(T),{title:"Enregistrement Appareil"}),h(q,null,{header:k(()=>[t("h2",J,[u.value?(o(),r("span",Q,"Modification d'un appareil")):(o(),r("span",W,"Nouvel Appareil"))])]),default:k(()=>[t("div",G,[e[24]||(e[24]=t("div",{class:"devices__create__titlebar dflex justify-content-between align-items-center"},[t("div",{class:"devices__create__titlebar--item"},[t("button",{class:"btn btn-secondary ml-1"},"Save")])],-1)),t("div",P,[t("div",Z,[t("div",z,[p.value?d("",!0):(o(),r("div",H,[e[10]||(e[10]=t("p",{class:"mb-1"},"Utilisateur",-1)),l(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=i=>f.value=i),placeholder:"Rechercher un utilisateur...",class:"input mb-2"},null,512),[[_,f.value]]),l(t("select",{"onUpdate:modelValue":e[1]||(e[1]=i=>s.user_id=i),class:"input",id:"user_id",name:"user_id"},[(o(!0),r(U,null,$(w.value,i=>(o(),r("option",{key:i.id,value:i.id},n(i.name),9,K))),128))],512),[[N,s.user_id]]),v(c).user_id?(o(),r("small",X,n(v(c).user_id),1)):d("",!0)])),!p.value||!u.value||p.value&&u.value&&!s.has_service?(o(),r("div",Y,[e[11]||(e[11]=t("p",{class:"mb-1"},"Marque",-1)),l(t("input",{type:"text",class:"input",id:"brand",name:"brand","onUpdate:modelValue":e[2]||(e[2]=i=>s.brand=i)},null,512),[[_,s.brand]]),v(c).brand?(o(),r("small",ee,n(v(c).brand),1)):d("",!0),e[12]||(e[12]=t("p",{class:"mb-1"},"Modèle",-1)),l(t("input",{type:"text",class:"input",id:"model_name",name:"model_name","onUpdate:modelValue":e[3]||(e[3]=i=>s.model_name=i)},null,512),[[_,s.model_name]]),v(c).model_name?(o(),r("small",se,n(v(c).model_name),1)):d("",!0),e[13]||(e[13]=t("p",{class:"mb-1"},"No de modèle",-1)),l(t("input",{type:"text",class:"input",id:"model_number",name:"model_number","onUpdate:modelValue":e[4]||(e[4]=i=>s.model_number=i)},null,512),[[_,s.model_number]]),e[14]||(e[14]=t("p",{class:"mb-1"},"Couleur",-1)),l(t("input",{type:"text",class:"input",id:"color",name:"color","onUpdate:modelValue":e[5]||(e[5]=i=>s.color=i)},null,512),[[_,s.color]]),e[15]||(e[15]=t("p",{class:"mb-1"},"No de série",-1)),l(t("input",{type:"text",class:"input",id:"serial_number",name:"serial_number","onUpdate:modelValue":e[6]||(e[6]=i=>s.serial_number=i)},null,512),[[_,s.serial_number]]),e[16]||(e[16]=t("p",{class:"mb-1"},"imei",-1)),l(t("input",{type:"text",class:"input",id:"imei",name:"imei","onUpdate:modelValue":e[7]||(e[7]=i=>s.imei=i)},null,512),[[_,s.imei]]),e[17]||(e[17]=t("p",{class:"my-1"},"Description (optional)",-1)),l(t("textarea",{cols:"10",rows:"5",class:"textarea",id:"description",name:"description","onUpdate:modelValue":e[8]||(e[8]=i=>s.description=i)},null,512),[[_,s.description]])])):d("",!0),p.value&&u.value&&s.has_service?(o(),r("div",te,[t("p",ie,"Marque: "+n(s.brand),1),t("p",ae,"Nom de modèle: "+n(s.model_name),1),t("p",re,"Numéro de modèle: "+n(s.model_number),1),t("p",oe,"Couleur: "+n(s.color),1),t("p",ne,"Numéro de série: "+n(s.serial_number),1),t("p",le,"imei: "+n(s.imei),1),t("p",de,"Description: "+n(s.description),1)])):d("",!0),p.value?d("",!0):(o(),r("div",me,[e[19]||(e[19]=t("p",{class:"mb-1"},"Restitué au client ?",-1)),l(t("select",{"onUpdate:modelValue":e[9]||(e[9]=i=>s.returned=i),class:"input",id:"returned",name:"returned",default:"0"},e[18]||(e[18]=[t("option",{value:"0"},"Non",-1),t("option",{value:"1"},"Oui",-1)]),512),[[N,s.returned]])])),p.value&&s.returned==0&&u.value?(o(),r("div",ue,e[20]||(e[20]=[t("p",null,"Appareil non restitué",-1)]))):d("",!0),p.value&&s.returned==1&&u.value?(o(),r("div",ce,e[21]||(e[21]=[t("p",null,"Appareil restitué",-1)]))):d("",!0),t("div",pe,[t("ul",_e,[t("li",ve,[t("div",be,[t("img",{src:A(),class:"devices__create__main--media--images--item--img",alt:""},null,8,fe)])]),t("li",ge,[t("form",ye,[e[22]||(e[22]=t("label",{class:"devices__create__main--media--images--item--form--label",for:"myfile"},"Add Image",-1)),t("input",{class:"devices__create__main--media--images--item--form--input",type:"file",id:"myfile",onChange:M},null,32)])])])])])])]),t("div",{class:"dflex justify-content-between align-items-center my-3"},[e[23]||(e[23]=t("p",null,null,-1)),t("button",{class:"btn btn-secondary",onClick:E},"Save")])])]),_:1})],64))}};export{Ce as default};
